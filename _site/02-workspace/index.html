















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2021-10-06 06:55:35 -0700">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/swc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/swc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/swc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/swc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/swc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/swc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/swc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/swc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Software Carpentry - ATLAS CMake"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/swc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/swc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/swc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/swc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/swc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  Your Workspace &ndash; ATLAS CMake
  </title>  

  </head>
  <body>

    


<div class="panel panel-default life-cycle">
  <div id="life-cycle" class="panel-body pre-alpha">
    This lesson is still being designed and assembled (Pre-Alpha version)
  </div>
</div>





    <div class="container">
      






<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://software-carpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/swc-icon-blue.svg" alt="Software Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-introduction/index.html">Introduction to ATLAS Offline Software</a></li>
            
            <li><a href="../02-workspace/index.html">Your Workspace</a></li>
            
            <li><a href="../03-toplevelcmake/index.html">The Top-Level CMakeLists.txt</a></li>
            
            <li><a href="../04-packagecmake/index.html">The Package CMakeLists.txt</a></li>
            
            <li><a href="../05-coffee/index.html">Coffee break!</a></li>
            
            <li><a href="../06-addcalibration/index.html">Calibrate Your Jets</a></li>
            
            <li><a href="../07-modifyingathena/index.html">Modyfing an Athena Package</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            <li><a href="../about/index.html">About</a></li>
            
            <li><a href="../discuss/index.html">Discussion</a></li>
            
            <li><a href="../figures/index.html">Figures</a></li>
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	<li><a href="/edit//_episodes/02-workspace.md" data-checker-ignore>Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>

















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../01-introduction/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">ATLAS CMake</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../03-toplevelcmake/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Your Workspace</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 20 min
      <br/>
      <strong>Exercises:</strong> 20 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How should I organize my code?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Learn about the standard structure for an ATLAS workspace.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h1 id="the-structure">The Structure</h1>

<p>When working on your analysis, you will most likely be editing, compiling and running code from several packages. There is a recommended way to organize your code. The structure is as follows:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">source/</code>: Place all your packages here, one per directory.</li>
  <li><code class="language-plaintext highlighter-rouge">source/CMakeLists.txt</code>: The top-level <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> file loading all of the ATLAS infrastructure and finding all of your packages.</li>
  <li><code class="language-plaintext highlighter-rouge">build/</code>: Compiled binaries.</li>
  <li><code class="language-plaintext highlighter-rouge">run/</code>: Place to run your analysis from (ie: where the results will be placed).</li>
</ul>

<p>This is only a recommendation. You can take other approaches, if you like. For example, I like to append the release version to the <code class="language-plaintext highlighter-rouge">build</code> directory name. This allows me to easily revert back to an older releases, in case I want to understand a change.</p>

<blockquote class="challenge">
  <h2 id="multiple-build-directories">Multiple Build Directories</h2>

  <p>What feature of CMake allows you to have multiple build directories?</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <p>This is an advantage of the <code class="language-plaintext highlighter-rouge">out-of-source</code> builds used in CMake. You can separate your source code from the binaries, allowing you to have several variations on the compiler in parallel.</p>
  </blockquote>
</blockquote>

<h1 id="transitioning-your-current-project">Transitioning Your Current Project</h1>
<p>At the end of the last day, you should be left with the following structure.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AnalysisPayload.cxx  CMakeLists.txt  JetSelectionHelper/  README.md		     
</code></pre></div></div>

<p>Our goal is to convert it into the structure similar to the one outline above. We will do this using git command, meaning that your whole change history will remain intact.</p>

<p>Start by creating the necessary directories.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir source</span>/
<span class="nb">mkdir </span>build/
<span class="nb">mkdir </span>run/
</code></pre></div></div>

<p>Then you should move your <code class="language-plaintext highlighter-rouge">JetSelectionHelper</code> package into the <code class="language-plaintext highlighter-rouge">source/</code> directory. Unfortunately, the version of git inside the docker image is quite old (a common theme with ATLAS software, stability is key for our experiment!) and does not yet include the ability to move git submodules. There is a manual way to do this by editing several files inside <code class="language-plaintext highlighter-rouge">.git/</code>, but that is outside the scope of this tutorial. Instead we will remove the old <code class="language-plaintext highlighter-rouge">JetSelectionHelper</code> submodule and re-add it as <code class="language-plaintext highlighter-rouge">source/JetSelectionHelper</code>. Since the <code class="language-plaintext highlighter-rouge">JetSelectionHelper</code> lives inside its own repository, you will not lose any of the change history by doing so.</p>

<p>Start by removing the work tree of your submodule from your local git repository.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git submodule deinit JetSelectionHelper
</code></pre></div></div>

<p>To remove the reference to the submodule, you need manually edit the <code class="language-plaintext highlighter-rouge">.gitmodule</code> file and delete the following section.</p>
<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[submodule "JetSelectionHelper"]
        path = JetSelectionHelper
        url = https://gitlab.cern.ch/usatlas-computing-bootcamp/JetSelectionHelper.git
</code></pre></div></div>

<p>Finally remove the directory itself from git’s index.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git <span class="nb">rm </span>JetSelectionHelper
</code></pre></div></div>

<p>After these three steps, your git repository will no longer know about the <code class="language-plaintext highlighter-rouge">JetSelectionHelper</code> submodule.</p>

<p>Next make a fork of the <a href="https://gitlab.cern.ch/usatlas-computing-bootcamp-2020/JetSelectionHelper">JetSelectionHelper repository</a>. You will be making a few modifications. Add it as a submodule under the <code class="language-plaintext highlighter-rouge">source/</code> directory. Don’t forget to replace <code class="language-plaintext highlighter-rouge">${USER}</code> with your GitLab username!</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git submodule add ssh://git@gitlab.cern.ch:7999/<span class="k">${</span><span class="nv">USER</span><span class="k">}</span>/JetSelectionHelper.git <span class="nb">source</span>/JetSelectionHelper
</code></pre></div></div>

<p>The last step is to move the <code class="language-plaintext highlighter-rouge">AnalysisPayload</code> codebase into a new package with the same name. This can be done simply by using the <code class="language-plaintext highlighter-rouge">git mv</code> command that you might have learned about yesterday. The following block of commands will move everything into the structure described earlier.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir source</span>/AnalysisPayload
<span class="nb">mkdir source</span>/AnalysisPayload/util
git <span class="nb">mv </span>AnalysisPayload.cxx <span class="nb">source</span>/AnalysisPayload/util/
git <span class="nb">rm </span>CMakeLists.txt
<span class="nb">rm source</span>/JetSelectionHelper/CMakeLists.txt
</code></pre></div></div>

<p>The list of changes to your repository should look like the following. Make sure to commit everything before moving to the next step! Don’t worry about the modified content (missing <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code>) inside the <code class="language-plaintext highlighter-rouge">JetSelectionHelper</code> for now.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># On branch master</span>
<span class="c"># Changes to be committed:</span>
<span class="c">#   (use "git reset HEAD &lt;file&gt;..." to unstage)</span>
<span class="c">#</span>
<span class="c">#       modified:   .gitmodules</span>
<span class="c">#       deleted:    CMakeLists.txt</span>
<span class="c">#       renamed:    AnalysisPayload.cxx -&gt; source/AnalysisPayload/util/AnalysisPayload.cxx</span>
<span class="c">#       renamed:    JetSelectionHelper -&gt; source/JetSelectionHelper</span>
<span class="c">#</span>
<span class="c"># Changes not staged for commit:</span>
<span class="c">#   (use "git add &lt;file&gt;..." to update what will be committed)</span>
<span class="c">#   (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)</span>
<span class="c">#   (commit or discard the untracked or modified content in submodules)</span>
<span class="c">#</span>
<span class="c">#       modified:   source/JetSelectionHelper (modified content)</span>
<span class="c">#</span>
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="tracking-the-build-directory">Tracking the build/ Directory</h2>

  <p>Notice that we did not at any point add the <code class="language-plaintext highlighter-rouge">build/</code> directory to the repository index. You should never version the contents this directory. Why?</p>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>

    <p>There are two important reasons:</p>
    <ul>
      <li>Git reduces the history size by storying only the differences between file versions. For binary files, which is what <code class="language-plaintext highlighter-rouge">build/</code> mostly contains, finding the differences is more complicated. Thus by default, will store the entire binary file anytime you make a change. This will blow up the size of your repository by a lot.</li>
      <li>Some of the files contain information custom to the user’s environment (ie: compiler, location of libraries). By versioning these files, you will clutter the history by tracking changes that are not relevent to the execution of the code.</li>
    </ul>

    <p>If you ever commit the <code class="language-plaintext highlighter-rouge">build/</code> directory, bad things will happen to you!</p>
  </blockquote>
</blockquote>



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use three directories: <code class="language-plaintext highlighter-rouge">source/</code> for code, <code class="language-plaintext highlighter-rouge">build/</code> for binaries and <code class="language-plaintext highlighter-rouge">run/</code> for output.</p>
</li>
    
  </ul>
</blockquote>

</article>
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../01-introduction/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../03-toplevelcmake/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <div class="row">
    <div class="col-md-6 copyright" align="left">
	
	Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2018–2021
	by <a href="https://carpentries.org/">The Carpentries</a>
        <br>
        Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2016–2018
	by <a href="https://software-carpentry.org">Software Carpentry Foundation</a>
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	<a href="/edit//_episodes/02-workspace.md" data-checker-ignore>Edit on GitHub</a>
	
	/
	<a href="/blob//CONTRIBUTING.md" data-checker-ignore>Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION" data-checker-ignore>Cite</a>
	/
	<a href="mailto:kkrizka@gmail.com">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
