















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2021-10-07 06:26:28 -0700">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/swc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/swc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/swc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/swc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/swc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/swc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/swc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/swc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Software Carpentry - ATLAS Example Workflow"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/swc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/swc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/swc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/swc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/swc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  Understanding the analysis organization &ndash; ATLAS Example Workflow
  </title>  

  </head>
  <body>

    


<div class="panel panel-default life-cycle">
  <div id="life-cycle" class="panel-body pre-alpha">
    This lesson is still being designed and assembled (Pre-Alpha version)
  </div>
</div>





    <div class="container">
      






<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://software-carpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/swc-icon-blue.svg" alt="Software Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-introduction/index.html">Introduction to ATLAS workflow</a></li>
            
            <li><a href="../02-submodule/index.html">Adding object kinematic selection modules</a></li>
            
            <li><a href="../03-analyisorganization/index.html">Understanding the analysis organization</a></li>
            
            <li><a href="../04-integratingsubmodules/index.html">Integrating submodules</a></li>
            
            <li><a href="../05-coffee/index.html">Coffee break!</a></li>
            
            <li><a href="../06-analysisselection/index.html">Analysis selection</a></li>
            
            <li><a href="../07-cutflow/index.html">Cutflow</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            <li><a href="../about/index.html">About</a></li>
            
            <li><a href="../discuss/index.html">Discussion</a></li>
            
            <li><a href="../figures/index.html">Figures</a></li>
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	<li><a href="/edit//_episodes/03-analyisorganization.md" data-checker-ignore>Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>

















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../02-submodule/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">ATLAS Example Workflow</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../04-integratingsubmodules/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Understanding the analysis organization</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 20 min
      <br/>
      <strong>Exercises:</strong> 10 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I structure my analysis code?</p>
</li>
	
	<li><p>How can I make kinematic selection on our objects?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Understand the submodules in the context of developing an analysis framework</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h1 id="organizing-your-analysis-framework">Organizing your analysis framework</h1>

<p>We have been working with different <code class="language-plaintext highlighter-rouge">cxx</code> files during the workshop and they all show how you can modularize your analysis framework. Different physics objects have different requirement and are retrieved differently from the <code class="language-plaintext highlighter-rouge">xAOD</code> or <code class="language-plaintext highlighter-rouge">DAOD</code> dataset. As a result, many analyses will have different libraries and files to retrieve and calibrate objects.</p>

<p>We usually separate our analysis framework into :</p>
<ul>
  <li>Object retrieval and calibration</li>
  <li>Event selection where we apply event level requirements: i.e was the data good quality during these runs?</li>
  <li>Analysis selector: we apply simple analysis selection and store variables into a <code class="language-plaintext highlighter-rouge">.root</code> file for further analysis</li>
</ul>

<p>In our example, we have simplifed this a bit. The <code class="language-plaintext highlighter-rouge">JetSelectionHelper</code> functions helps apply kinematic requirements on the objects. <code class="language-plaintext highlighter-rouge">AnalysisPayload</code> applies the calibration and performs the selection. We will go through both of these in a bit more detail.</p>

<h1 id="understanding-the-object-selection">Understanding the object selection</h1>

<p>Every analysis on ATLAS makes selections based on the objects. Those are limited by object detection and calibrations. For example, if a particle has too low momentum or too high pseudorapidity, it will not detected by the ATLAS detector.</p>

<p>The <code class="language-plaintext highlighter-rouge">&lt;object&gt;SelectionHelper</code> folders are there to select basic kinematics about the objects.</p>

<h2 id="momentum-and-pseudorapidity-requirements">Momentum and pseudorapidity requirements</h2>

<p>If you open <code class="language-plaintext highlighter-rouge">JetSelectionHelper.cxx</code> in <code class="language-plaintext highlighter-rouge">JetSelectionHelper/src/</code>, you will see two functions: <code class="language-plaintext highlighter-rouge">isJetGood</code> and <code class="language-plaintext highlighter-rouge">isJetBFlavor</code>.</p>

<p>The first function checks that the following requirements are satisfied:</p>
<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if ( jet-&gt;pt() &gt; 50000 &amp;&amp; fabs(jet-&gt;eta()) &lt; 2.5 ){
  passSelect = true;
}
</code></pre></div></div>

<p>Note: the <code class="language-plaintext highlighter-rouge">pt</code> here is in <code class="language-plaintext highlighter-rouge">MeV</code> instead of the unit <code class="language-plaintext highlighter-rouge">GeV</code> that is more commonly used.</p>

<p>The next function is to help determine the flavor of the jet by applying <code class="language-plaintext highlighter-rouge">b-tagging</code>.  The b-quarks hadronize before they decay, resulting in a decay length of ~0.5mm. As a result, specialized tagging algorithms are developed to determine if a jet is a b-jet.</p>

<p>You can learn more about the b-tagging algorithms in the <a href="https://twiki.cern.ch/twiki/bin/view/AtlasProtected/BTaggingAlgorithmsSubgroup"> b-tagging subgroup twiki</a>.</p>

<p>In the <code class="language-plaintext highlighter-rouge">isJetBFlavor</code> function, we first retrieve the probability of the jet being tagged as a b-jet.</p>
<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>btag-&gt;pb("DL1r",prob_b);
</code></pre></div></div>

<p>We then apply a selection only this probability to identify the jet as being b-tagged.</p>
<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if(prob_b&gt;0.8)
  passSelect = true;
</code></pre></div></div>

<p>The muons and electrons have similar <code class="language-plaintext highlighter-rouge">SelectionHelper</code> algorithms but those only contain requirements on the <code class="language-plaintext highlighter-rouge">pt</code> and <code class="language-plaintext highlighter-rouge">eta</code>. Feel free to take a look at the requirements applied to the electrons and the muons.</p>

<blockquote class="challenge">
  <h2 id="electron-eta-requirement">Electron eta requirement</h2>

  <p>Why do we veto electrron eta between 1.37 and 1.52?</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <p>In the eta range of 1.37 to 1.52 the calorimeter has a transition from the barrrel and the endcap with a lot of inactive material.</p>
  </blockquote>
</blockquote>

<h1 id="going-through-the-analysis-payload">Going through the analysis payload</h1>

<h2 id="libraries-included">Libraries included</h2>

<p>To be able to run through the events in our MC dataset, we need to add different includes. The first are event-level from the ATLAS event data model (EDM). Some are event level: <code class="language-plaintext highlighter-rouge">Init.h</code>, <code class="language-plaintext highlighter-rouge">TEvent.h</code>, and <code class="language-plaintext highlighter-rouge">EventInfo.h</code>. Others are based on the objects being considered: <code class="language-plaintext highlighter-rouge">JetContainer.h</code>. We also have the jet calibration libraries that were added in a previous module.</p>
<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// ATLAS EDM functionality                                                                                                       
#include "xAODRootAccess/Init.h"
#include "xAODRootAccess/TEvent.h"
#include "xAODEventInfo/EventInfo.h"
#include "xAODJet/JetContainer.h"
// jet calibration                                                                                                               
#include "AsgTools/AnaToolHandle.h"
#include "JetCalibTools/IJetCalibrationTool.h"
</code></pre></div></div>

<p>We also have the libraries we had added as a submodule: <code class="language-plaintext highlighter-rouge">JetSelectionHelper.h</code>. In the next part of the lesson, we will worry about properly adding our new submodules.</p>
<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// our library functionality                                                                                                     
#include "JetSelectionHelper/JetSelectionHelper.h"
</code></pre></div></div>

<h2 id="running-over-events">Running over events</h2>

<p>We first initialize the EDM as shown in the following code snippet</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xAOD::Init();
</code></pre></div></div>

<p>To be able to read events one by event, we first loop over all the events and we need to load the event.</p>
<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code> event.getEntry( i );
</code></pre></div></div>

<p>Object containers need to be retrieved from the event store. We create null pointer and fill all <code class="language-plaintext highlighter-rouge">AntiKt4EMTopoJets</code> into our <code class="language-plaintext highlighter-rouge">JetContainer</code>.</p>
<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code> const xAOD::JetContainer* jets = nullptr;
 event.retrieve(jets, "AntiKt4EMTopoJets");
</code></pre></div></div>

<p>To be able to make use of the b-tagging later, let’s change the jet container we retrieve from <code class="language-plaintext highlighter-rouge">AntiKt4EMTopoJets</code> to <code class="language-plaintext highlighter-rouge">AntiKt4EMTopoJets_BTagging201810</code>. Your code should now look like this.</p>
<pre class="source"><code class="language-code"> event.retrieve(jets, "AntiKt4EMTopoJets_BTagging201810");
</code></pre>

<p>We can then apply the kinematic requirements we defined in the <code class="language-plaintext highlighter-rouge">JetSelectionHelper</code> files.</p>
<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code> if( myJetTool.isJetGood(jet) ){
   jets_kin.push_back(*jet);
 }
</code></pre></div></div>



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>When you write an analysis framework, you want to split your code into different libraries</p>
</li>
    
    <li><p>You can integrate different libraries to aid in object selection.</p>
</li>
    
  </ul>
</blockquote>

</article>
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../02-submodule/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../04-integratingsubmodules/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <div class="row">
    <div class="col-md-6 copyright" align="left">
	
	Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2018–2021
	by <a href="https://carpentries.org/">The Carpentries</a>
        <br>
        Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2016–2018
	by <a href="https://software-carpentry.org">Software Carpentry Foundation</a>
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	<a href="/edit//_episodes/03-analyisorganization.md" data-checker-ignore>Edit on GitHub</a>
	
	/
	<a href="/blob//CONTRIBUTING.md" data-checker-ignore>Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION" data-checker-ignore>Cite</a>
	/
	<a href="mailto:eresseguie@gmail.com">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
