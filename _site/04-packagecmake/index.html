















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2021-10-06 06:55:35 -0700">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/swc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/swc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/swc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/swc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/swc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/swc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/swc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/swc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Software Carpentry - ATLAS CMake"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/swc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/swc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/swc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/swc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/swc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  The Package CMakeLists.txt &ndash; ATLAS CMake
  </title>  

  </head>
  <body>

    


<div class="panel panel-default life-cycle">
  <div id="life-cycle" class="panel-body pre-alpha">
    This lesson is still being designed and assembled (Pre-Alpha version)
  </div>
</div>





    <div class="container">
      






<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://software-carpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/swc-icon-blue.svg" alt="Software Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-introduction/index.html">Introduction to ATLAS Offline Software</a></li>
            
            <li><a href="../02-workspace/index.html">Your Workspace</a></li>
            
            <li><a href="../03-toplevelcmake/index.html">The Top-Level CMakeLists.txt</a></li>
            
            <li><a href="../04-packagecmake/index.html">The Package CMakeLists.txt</a></li>
            
            <li><a href="../05-coffee/index.html">Coffee break!</a></li>
            
            <li><a href="../06-addcalibration/index.html">Calibrate Your Jets</a></li>
            
            <li><a href="../07-modifyingathena/index.html">Modyfing an Athena Package</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            <li><a href="../about/index.html">About</a></li>
            
            <li><a href="../discuss/index.html">Discussion</a></li>
            
            <li><a href="../figures/index.html">Figures</a></li>
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	<li><a href="/edit//_episodes/04-packagecmake.md" data-checker-ignore>Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>

















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../03-toplevelcmake/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">ATLAS CMake</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../05-coffee/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">The Package CMakeLists.txt</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 20 min
      <br/>
      <strong>Exercises:</strong> 20 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How do I compile my package?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Use ATLAS CMake macros to specify an executable and library targets.</p>
</li>
	
	<li><p>Add ATLAS packages as dependencies.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>In this section, we will write two <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> files; one for the <code class="language-plaintext highlighter-rouge">JetSelectionHelper</code> package and one for the <code class="language-plaintext highlighter-rouge">AnalysisPayload</code> package. The contents will tell CMake how to compile each package. The former will teach you how to define a library and the latter how to define an executable program.</p>

<p>The approach we will take is to slowly construct the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> incrementaly adding blocks and running <code class="language-plaintext highlighter-rouge">make</code> each time. Quite often, this will result in an error. We will then analyze the error and implement the next block that fixes it.</p>

<h1 id="compiling-jetselectionhelper">Compiling JetSelectionHelper</h1>

<p>Start by creating a new file at <code class="language-plaintext highlighter-rouge">source/JetSelectionHelper/CMakeLists.txt</code> with the following contents. The <code class="language-plaintext highlighter-rouge">ATLAS_SUBDIR</code> line identifies your directory as an ATLAS package with the name <code class="language-plaintext highlighter-rouge">JetSelectionHelper</code>.</p>

<div class="language-cmake source highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># The name of the package</span>
<span class="nf">ATLAS_SUBDIR</span><span class="p">(</span>JetSelectionHelper<span class="p">)</span>
</code></pre></div></div>

<p>Let’s see what this will do. At this point, you need to run <code class="language-plaintext highlighter-rouge">cmake ../source</code> again for CMake to learn about the new file. After this, you only need to run <code class="language-plaintext highlighter-rouge">make</code> to process any changes.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run from build/ directory</span>
cmake ../source
make
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Boring CMake output
Scanning dependencies of target Package_JetSelectionHelper_tests
[  0%] Built target Package_JetSelectionHelper_tests
Scanning dependencies of target atlas_tests
[  0%] Built target atlas_tests
Scanning dependencies of target Package_JetSelectionHelper
[100%] Built package JetSelectionHelper
JetSelectionHelper: Package build succeeded
[100%] Built target Package_JetSelectionHelper
</code></pre></div></div>

<p>You can see that now the package is being picked up by make. Great! However your binary is not being compiled. Not so great. This is because we have not defined what should be compile using what source code. This is done using the <code class="language-plaintext highlighter-rouge">ATLAS_ADD_LIBRARY</code> command. It is the equivalent of the standard CMake <code class="language-plaintext highlighter-rouge">ADD_LIBRARY</code> command, but with convenience added in for handling dependencies.</p>

<p>Add the following line to tell CMake that you want to compile a library called <code class="language-plaintext highlighter-rouge">JetSelectionHelperLib</code> using the source file <code class="language-plaintext highlighter-rouge">src/JetSelectionHelper.cxx</code>. It also copies your header files, that will be used by other packages depending on <code class="language-plaintext highlighter-rouge">JetSelectionHelperLib</code> (ie: <code class="language-plaintext highlighter-rouge">AnalysisPayload</code>) to a central place.</p>

<div class="language-cmake source highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Add binary</span>
<span class="nf">ATLAS_ADD_LIBRARY</span> <span class="p">(</span> JetSelectionHelperLib JetSelectionHelper/JetSelectionHelper.h src/JetSelectionHelper.cxx
		  PUBLIC_HEADERS JetSelectionHelper <span class="p">)</span>
</code></pre></div></div>

<p>Let’s see what this will do. Note that you only need to run <code class="language-plaintext highlighter-rouge">make</code> this time. CMake already knows about your <code class="language-plaintext highlighter-rouge">JetSelectionHelper/CMakeLists.txt</code> from the previous step, allowing <code class="language-plaintext highlighter-rouge">make</code> to automatically look for updates.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run from build/ directory</span>
make
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Scanning dependencies of target JetSelectionHelperHeaderInstall
[ 25%] Generating ../x86_64-centos7-gcc8-opt/include/JetSelectionHelper
[ 25%] Built target JetSelectionHelperHeaderInstall
Scanning dependencies of target JetSelectionHelperLib
[ 50%] Building CXX object JetSelectionHelper/CMakeFiles/JetSelectionHelperLib.dir/src/JetSelectionHelper.cxx.o
In file included from /home/kkrizka/Bootcamp/v1-gitlab-finished-code/source/JetSelectionHelper/src/JetSelectionHelper.cxx:1:
/home/kkrizka/Bootcamp/v1-gitlab-finished-code/source/JetSelectionHelper/JetSelectionHelper/JetSelectionHelper.h:1:10: fatal error: xAODJet/Jet.h: No such file or directory
 #include "xAODJet/Jet.h"
          ^~~~~~~~~~~~~~~
compilation terminated.
make[2]: *** [JetSelectionHelper/CMakeFiles/JetSelectionHelperLib.dir/src/JetSelectionHelper.cxx.o] Error 1
make[1]: *** [JetSelectionHelper/CMakeFiles/JetSelectionHelperLib.dir/all] Error 2
make: *** [all] Error 2
</code></pre></div></div>

<p>Here we have our first error, <code class="language-plaintext highlighter-rouge">fatal error: xAODJet/Jet.h: No such file or directory</code> , telling us that we are missing something. Without any arguments, <code class="language-plaintext highlighter-rouge">ATLAS_ADD_LIBRARY</code> thinks that our library does not depend on any extra packages. But we are using quite a few central packages, like <code class="language-plaintext highlighter-rouge">xAODJet</code> for storing the jet representation. To find the name of the package, just look at the directory where the header file is stored.</p>

<p>The dependency can be added by using the <code class="language-plaintext highlighter-rouge">LINK_LIBRARIES</code> option with a list of packages. Update the call to <code class="language-plaintext highlighter-rouge">ATLAS_ADD_LIBRARY</code> to look like this:</p>

<div class="language-cmake source highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">ATLAS_ADD_LIBRARY</span> <span class="p">(</span> JetSelectionHelperLib JetSelectionHelper/JetSelectionHelper.h src/JetSelectionHelper.cxx
		  PUBLIC_HEADERS JetSelectionHelper
		  LINK_LIBRARIES xAODEventInfo
				 xAODRootAccess
				 xAODJet<span class="p">)</span>
</code></pre></div></div>

<p>Now run <code class="language-plaintext highlighter-rouge">make</code> again and you should see it complete sucessfully.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run from build/ directory</span>
make
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Boring output from cmake detecting an updated and being automatically rerun
# Boring compilation output
Scanning dependencies of target JetSelectionHelperLib
[ 25%] Building CXX object JetSelectionHelper/CMakeFiles/JetSelectionHelperLib.dir/src/JetSelectionHelper.cxx.o
[ 50%] Linking CXX shared library ../x86_64-centos7-gcc8-opt/lib/libJetSelectionHelperLib.so
Detaching debug info of libJetSelectionHelperLib.so into libJetSelectionHelperLib.so.dbg
[ 50%] Built target JetSelectionHelperLib
Scanning dependencies of target JetSelectionHelperHeaderInstall
[ 75%] Generating ../x86_64-centos7-gcc8-opt/include/JetSelectionHelper
[ 75%] Built target JetSelectionHelperHeaderInstall
Scanning dependencies of target Package_JetSelectionHelper
[100%] Built package JetSelectionHelper
JetSelectionHelper: Package build succeeded
[100%] Built target Package_JetSelectionHelper
</code></pre></div></div>

<h1 id="compiling-analysispayload">Compiling AnalysisPayload</h1>

<p>Now that our helper library is compiled, let’s turn our attention to the executable that runs our analysis. Start by creating a <code class="language-plaintext highlighter-rouge">CMakaLists.txt</code> file. This time, we will use the <code class="language-plaintext highlighter-rouge">ATLAS_ADD_EXECUTABLE</code> command to declare an executable target. It has the same syntax as <code class="language-plaintext highlighter-rouge">ATLAS_ADD_LIBRARY</code>, but creates a binary instead of a library.</p>

<p>Try writing the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> file on your own! Don’t forget that our <code class="language-plaintext highlighter-rouge">AnalysisPayload</code> program depends on functions from the <code class="language-plaintext highlighter-rouge">JetSelectionHelper</code> package.</p>

<blockquote class="solution">
  <h2 id="solution">Solution</h2>

  <p>The contents of <code class="language-plaintext highlighter-rouge">../source/AnalysisPayload/CMakeLists.txt</code> should be the following:</p>

  <div class="language-cmake source highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># The name of the package</span>
<span class="nf">ATLAS_SUBDIR</span><span class="p">(</span>AnalysisPayload<span class="p">)</span>

<span class="c1"># Add binary</span>
<span class="nf">ATLAS_ADD_EXECUTABLE</span> <span class="p">(</span> AnalysisPayload util/AnalysisPayload.cxx
                     LINK_LIBRARIES  xAODEventInfo
                                     xAODRootAccess
                                     xAODJet
                                     JetSelectionHelperLib<span class="p">)</span>
</code></pre></div>  </div>
</blockquote>

<p>On success, you should see the following when you try to build.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run from build/ directory</span>
cmake ../source
make
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Boring CMake output
# Boring output
Scanning dependencies of target AnalysisPayload
[ 42%] Building CXX object AnalysisPayload/CMakeFiles/AnalysisPayload.dir/util/AnalysisPayload.cxx.o
[ 57%] Linking CXX executable ../x86_64-centos7-gcc8-opt/bin/AnalysisPayload
# Boring Output
</code></pre></div></div>

<p>Now try running it. Note that the executable is in your <code class="language-plaintext highlighter-rouge">PATH</code>, so you can call it directly. Prefereably from within your <code class="language-plaintext highlighter-rouge">run/</code> directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run from run/ directory</span>
AnalysisPayload
</code></pre></div></div>

<p>We now have a working package! It is a good time to checkpoint and commit all of your changes.</p>



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use ATLAS macros. They specify a structure to your <code class="language-plaintext highlighter-rouge">build/</code> directory that makes your life easy!</p>
</li>
    
  </ul>
</blockquote>

</article>
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../03-toplevelcmake/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../05-coffee/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <div class="row">
    <div class="col-md-6 copyright" align="left">
	
	Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2018–2021
	by <a href="https://carpentries.org/">The Carpentries</a>
        <br>
        Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2016–2018
	by <a href="https://software-carpentry.org">Software Carpentry Foundation</a>
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	<a href="/edit//_episodes/04-packagecmake.md" data-checker-ignore>Edit on GitHub</a>
	
	/
	<a href="/blob//CONTRIBUTING.md" data-checker-ignore>Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION" data-checker-ignore>Cite</a>
	/
	<a href="mailto:kkrizka@gmail.com">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
