



<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2021-10-22 01:31:57 -0700">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="http://localhost:4000/assets/favicons/swc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/assets/favicons/swc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/assets/favicons/swc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/assets/favicons/swc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="http://localhost:4000/assets/favicons/swc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://localhost:4000/assets/favicons/swc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="http://localhost:4000/assets/favicons/swc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://localhost:4000/assets/favicons/swc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="http://localhost:4000/assets/favicons/swc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="http://localhost:4000/assets/favicons/swc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="http://localhost:4000/assets/favicons/swc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="http://localhost:4000/assets/favicons/swc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="http://localhost:4000/assets/favicons/swc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Software Carpentry - ATLAS Example Workflow"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="http://localhost:4000/assets/favicons/swc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="http://localhost:4000/assets/favicons/swc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="http://localhost:4000/assets/favicons/swc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="http://localhost:4000/assets/favicons/swc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="http://localhost:4000/assets/favicons/swc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>ATLAS Example Workflow: Integrating submodules</title>
  </head>
  <body>

    


<div class="panel panel-default life-cycle">
  <div id="life-cycle" class="panel-body pre-alpha">
    This lesson is still being designed and assembled (Pre-Alpha version)
  </div>
</div>





    <div class="container">
      
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://software-carpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/swc-icon-blue.svg" alt="Software Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-introduction/index.html">Introduction to ATLAS workflow</a></li>
            
            <li><a href="../02-submodule/index.html">Adding object kinematic selection modules</a></li>
            
            <li><a href="../03-analyisorganization/index.html">Understanding the analysis organization</a></li>
            
            <li><a href="../04-integratingsubmodules/index.html">Integrating submodules</a></li>
            
            <li><a href="../05-coffee/index.html">Coffee break!</a></li>
            
            <li><a href="../06-analysisselection/index.html">Analysis selection</a></li>
            
            <li><a href="../07-cutflow/index.html">Cutflow</a></li>
            
            <li><a href="../08-condor/index.html">Optional: Using condor</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	<li><a href="/edit/gh-pages/_episodes/04-integratingsubmodules.md">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>


<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../03-analyisorganization/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">ATLAS Example Workflow</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../05-coffee/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Integrating submodules</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 10 min
      <br/>
      <strong>Exercises:</strong> 30 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I integrate my submodules into the analysis code?</p>
</li>
	
	<li><p>What changes to cmake will I need to do to add the new libraries?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Retrieve additional objects from the ATLAS EDM</p>
</li>
	
	<li><p>Review how to make changes to cmake</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h1 id="retrieving-new-objects-in-analysispayload">Retrieving new objects in AnalysisPayload</h1>

<p>We added two submodules to help with the electron and muon selections. Now we need to properly add them to our code so we can retrieve those objects and use them in our analysis.</p>

<h2 id="updating-libraries">Updating libraries</h2>

<p>We need to add the electron and muon libaries from the ATLAS EDM. We want to retrieve electron and muon containers from the event store, just like we did for jets.</p>

<p>In the block, <code class="language-plaintext highlighter-rouge">ATLAS EDM functionality</code>, you should add</p>
<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include "xAODEgamma/ElectronContainer.h"
#include "xAODMuon/MuonContainer.h"
</code></pre></div></div>

<p>To make use of the helper functions we added in the submodules, we also need to our new <code class="language-plaintext highlighter-rouge">HelperSelection</code> libaries under <code class="language-plaintext highlighter-rouge">#include "JetSelectionHelper/JetSelectionHelper.h"</code></p>
<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include "ElectronSelectionHelper/ElectronSelectionHelper.h"
#include "MuonSelectionHelper/MuonSelectionHelper.h"
</code></pre></div></div>

<h2 id="retrieving-new-objects">Retrieving new objects</h2>

<p>Just like we retrieved the jet container from the event store, we need to do the same for the electrons and the muons.</p>

<p>Electrons are retrieved from the <code class="language-plaintext highlighter-rouge">ElectronContainer</code> as follows</p>
<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const xAOD::ElectronContainer *electrons = nullptr;
event.retrieve(electrons, "Electrons" ) ;
</code></pre></div></div>

<p>The muons are retrieved from the <code class="language-plaintext highlighter-rouge">MuonContainer</code> as follows</p>
<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const xAOD::MuonContainer *muons = nullptr;
event.retrieve(muons, "Muons") ;
</code></pre></div></div>

<p>Normally, we would want to calibrate the electrons and the muons, just as we did for the jets; however, we will not do this today.</p>

<p>If you are interested in how to retrieve additional objects and their calibrations, you can refer to this <a href="https://twiki.cern.ch/twiki/bin/view/AtlasComputing/SoftwareTutorialxAODAnalysisInROOT">xAOD analysis tutorial twikli</a>.</p>

<h2 id="selecting-electrons">Selecting electrons</h2>

<p>Now that we have retrieved the electrons and muons, we want to save the electron and muon vectors that are present in our dataset as well as those that pass the pt and eta requirements defined in the <code class="language-plaintext highlighter-rouge">ElectronSelectionHelper</code> and <code class="language-plaintext highlighter-rouge">MuonSelectionHelper</code>.</p>

<p>Let us first declare the <code class="language-plaintext highlighter-rouge">ElectronSelectionHelper</code> tool, similar to what was done for jets.</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ElectronSelectionHelper electron_selector;
</code></pre></div></div>

<p>We will create a vector for the electrons that pass the requirements in <code class="language-plaintext highlighter-rouge">ElectronSelectionHelper</code> called <code class="language-plaintext highlighter-rouge">electrons_kin</code> (to follow the terminology we used for jets).</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>std::vector&lt;xAOD::Electron&gt; electrons_kin;
</code></pre></div></div>

<p>We can loop over our electron container and fill electrons into the vectors, similar to what is done for the jets.</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for(const xAOD::Electron* electron : *electrons) {
    if( electron_selector.isElectronGood(electron) ){
        electrons_kin.push_back(*electron);
    }
}
</code></pre></div></div>

<p>In the above <code class="language-plaintext highlighter-rouge">for loop</code>, we can add a printout of electron kinematics that we will use later on.</p>
<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>std::cout &lt;&lt; "Electron : " &lt;&lt; electron-&gt;pt() &lt;&lt; "\t" &lt;&lt; electron-&gt;eta() &lt;&lt; "\t" &lt;&lt; electron-&gt;phi() &lt;&lt; "\t" &lt;&lt; electron-&gt;m() &lt;&lt; "\t" &lt;&lt; electron-&gt;charge() &lt;&lt; std::endl;
</code></pre></div></div>

<p>The only variable that is new in this printout for electrons, as opposed to jets, is the <code class="language-plaintext highlighter-rouge">charge</code>.</p>

<blockquote class="challenge">
  <h2 id="adding-muons">Adding muons</h2>

  <p>Modify the <code class="language-plaintext highlighter-rouge">AnalysisPayload</code> program to retrieve loop over the <code class="language-plaintext highlighter-rouge">muons</code> collection and store the muons into a vector for the muons that pass the <code class="language-plaintext highlighter-rouge">isMuonGood</code> selection from <code class="language-plaintext highlighter-rouge">MuonSelectionHelper</code> called <code class="language-plaintext highlighter-rouge">muons_kin</code>.</p>

</blockquote>

<blockquote class="solution">
  <h2 id="solution">Solution</h2>
  <p>The lines of code you will need to add are shown below; however, their location is not specified.</p>

  <div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MuonSelectionHelper muon_selector;
std::vector&lt;xAOD::Muon&gt; muons_kin;
for(const xAOD::Muon* muon : *muons) {
   if( muon_selector.isMuonGood(muon) ){
       muons_kin.push_back(*muon);
   }
}
</code></pre></div>  </div>

</blockquote>

<h1 id="updating-the-cmakelists">Updating the CMakeLists</h1>

<p>In the CMake module, you saw that when you added the <code class="language-plaintext highlighter-rouge">jet calibration</code> libraries, you needed to update the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> in the <code class="language-plaintext highlighter-rouge">AnalysisPayload</code> folder, otherwise you would get a build error.</p>

<p>Since we have added 2 submodules and included them in  <code class="language-plaintext highlighter-rouge">AnalysisPayload</code>, we also need to add them to the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code>.</p>

<p>After you have updated the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code>, outside of <code class="language-plaintext highlighter-rouge">source</code>, compile and build your code.</p>

<blockquote class="solution">
  <h2 id="solution-1">Solution</h2>

  <p>The libraries we need to link are <code class="language-plaintext highlighter-rouge">xAODEgamma</code>, <code class="language-plaintext highlighter-rouge">xAODMuon</code>, <code class="language-plaintext highlighter-rouge">ElectronSelectionHelperLib</code>, and <code class="language-plaintext highlighter-rouge">MuonSelectionHelperLib</code>.
Your <code class="language-plaintext highlighter-rouge">AnalysisPayload/CMakeLists.txt</code> should now contain the following.</p>

  <div class="language-cmake source highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">ATLAS_ADD_EXECUTABLE</span> <span class="p">(</span> AnalysisPayload utils/AnalysisPayload.cxx
INCLUDE_DIRS <span class="si">${</span><span class="nv">ROOT_INCLUDE_DIRS</span><span class="si">}</span>
LINK_LIBRARIES <span class="si">${</span><span class="nv">ROOT_LIBRARIES</span><span class="si">}</span>
                xAODEventInfo
                xAODRootAccess
                xAODJet
                xAODEgamma
                xAODMuon
                AsgTools
                JetCalibToolsLib
                JetSelectionHelperLib
                ElectronSelectionHelperLib
                MuonSelectionHelperLib<span class="p">)</span>
</code></pre></div>  </div>

</blockquote>



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>When we add a new submodule, we need to update cmake.</p>
</li>
    
    <li><p>Running over xAODs/DAODs is not that scary</p>
</li>
    
  </ul>
</blockquote>

</article>

<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../03-analyisorganization/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../05-coffee/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      
<footer>
  <div class="row">
    <div class="col-md-6 copyright" align="left">
	
	Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2018–2021
	by <a href="https://carpentries.org/">The Carpentries</a>
        <br>
        Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2016–2018
	by <a href="https://software-carpentry.org">Software Carpentry Foundation</a>
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	<a href="/edit/gh-pages/_episodes/04-integratingsubmodules.md">Edit on GitHub</a>
	
	/
	<a href="/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob/gh-pages/CITATION">Cite</a>
	/
	<a href="mailto:eresseguie@gmail.com">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
